<!-- pages/fissionTask/index.wxml -->

<view style="padding:24rpx;">
  <view style="font-size:34rpx;font-weight:600;">裂变任务中心</view>

  <!-- 出错兜底 -->
  <view wx:if="{{pageError}}" style="margin-top:16rpx;">
    <view style="font-weight:600;color:#d93026;">页面异常（已拦截，避免白屏）</view>
    <view style="margin-top:12rpx;color:#666;font-size:24rpx;">{{pageErrorWhere}}</view>
    <view style="margin-top:12rpx;color:#333;font-size:24rpx;word-break:break-all;">{{pageError}}</view>
    <button style="margin-top:20rpx;" bindtap="onRetry">重试</button>
  </view>

  <!-- 正常态 -->
  <view wx:else>
    <view style="margin-top:16rpx;color:#666;">{{statusText}}</view>

    <view wx:if="{{pageLoading}}" style="margin-top:16rpx;color:#999;font-size:26rpx;">
      加载中...
    </view>

    <view style="margin-top:20rpx;padding:18rpx;border:1px solid #eee;border-radius:12rpx;">
      <view style="color:#666;">clientId</view>
      <view style="margin-top:8rpx;word-break:break-all;">{{clientId}}</view>
    </view>

    <view style="margin-top:20rpx;padding:18rpx;border:1px solid #eee;border-radius:12rpx;">
      <view style="color:#666;">invitedByCode</view>
      <view style="margin-top:8rpx;">{{invitedByCode || '未绑定'}}</view>
    </view>

    <view wx:if="{{incomingInviteCode}}" style="margin-top:20rpx;padding:18rpx;border:1px dashed #ddd;border-radius:12rpx;">
      <view style="color:#666;">pendingInviteCode</view>
      <view style="margin-top:8rpx;">{{incomingInviteCode}}</view>
    </view>

    <view wx:if="{{qrcodeUrl}}" style="margin-top:24rpx;">
      <view style="color:#666;margin-bottom:12rpx;">我的邀请二维码</view>
      <image mode="widthFix" src="{{qrcodeUrl}}" style="width:420rpx;" />
    </view>

    <view style="margin-top:28rpx;display:flex;gap:16rpx;flex-wrap:wrap;">
      <button open-type="share">一键分享</button>
      <button bindtap="goCamp">去训练营</button>
      <button bindtap="goHome">回首页</button>
    </view>

    <view style="margin-top:20rpx;">
      <button size="mini" bindtap="toggleDebug">Debug 开关</button>
    </view>

    <view wx:if="{{debug}}" style="margin-top:16rpx;padding:18rpx;background:#f7f7f7;border-radius:12rpx;">
      <view style="font-weight:600;margin-bottom:10rpx;">Debug</view>
      <view style="font-size:24rpx;word-break:break-all;">myInviteCode={{myInviteCode || ''}}</view>
    </view>
  </view>
</view>