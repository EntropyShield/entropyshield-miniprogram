<view class="page">
  <!-- Header -->
  <view class="page-header">
    <view class="page-title">控局日历</view>
    <view class="page-subtitle">按“即将开播 / 全部 / 已结束”筛选课程</view>

    <view class="filter-tab">
      <view
        class="tab-item {{filterType==='upcoming' ? 'active' : ''}}"
        data-type="upcoming"
        bindtap="onTapFilter"
      >
        即将开播
      </view>
      <view
        class="tab-item {{filterType==='all' ? 'active' : ''}}"
        data-type="all"
        bindtap="onTapFilter"
      >
        全部
      </view>
      <view
        class="tab-item {{filterType==='ended' ? 'active' : ''}}"
        data-type="ended"
        bindtap="onTapFilter"
      >
        已结束
      </view>
    </view>
  </view>

  <!-- Loading / Error -->
  <view wx:if="{{loading}}" class="tip-text">加载中…</view>

  <view wx:elif="{{errorMsg}}" class="tip-text tip-error">
    {{errorMsg}}
  </view>

  <!-- List -->
  <scroll-view
    wx:else
    class="course-scroll"
    scroll-y="true"
    enhanced="true"
    show-scrollbar="false"
  >
    <view wx:if="{{!courseGroups || courseGroups.length===0}}" class="empty-tip">
      暂无课程
    </view>

    <block wx:else>
      <block wx:for="{{courseGroups}}" wx:key="dateKey" wx:for-item="g">
        <view class="date-row">
          <view class="date-text">{{g.dateText}}</view>
        </view>

        <block wx:for="{{g.list}}" wx:key="id" wx:for-item="c">
          <view class="course-card" data-id="{{c.id}}" bindtap="onTapCourse">
            <view class="card-top">
              <view class="title-wrap">
                <view class="title-dot"></view>
                <view class="course-title">{{c.title}}</view>
              </view>
              <view class="type-tag">{{c.courseTypeText}}</view>
            </view>

            <view class="card-middle">
              <view class="time-text">{{c.timeText}}</view>
              <view class="status-tag {{c.statusClass}}">{{c.statusText}}</view>
            </view>

            <view wx:if="{{c.progressText}}" class="card-bottom">
              <view class="progress-bar">
                <!-- [P0-FIX-PROGRESS-WIDTH] -->
                <view class="progress-inner" style="width: {{c.progressWidth}};"></view>
              </view>
              <view class="progress-label">{{c.progressText}}</view>
            </view>
          </view>
        </block>
      </block>
    </block>
  </scroll-view>
</view>
