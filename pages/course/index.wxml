<view class="page">

<!-- 顶部：标题 + 筛选 -->
<view class="topbar">
  <!-- [P3-QUICK-PROGRESS-20251215] 增加“我的进度”快捷入口 -->
  <view class="top-row">
    <view class="top-title">熵盾研究院 · 控局日历</view>
    <view class="top-action" bindtap="goCourseProgress">我的进度</view>
  </view>

  <view class="top-sub">公开课 / 体验课 / 训练营 / 线下沙龙</view>

  <view class="tabs">
    <view class="tab {{filterType==='upcoming'?'tab-on':''}}" data-type="upcoming" bindtap="onTabTap">即将开播</view>
    <view class="tab {{filterType==='all'?'tab-on':''}}" data-type="all" bindtap="onTabTap">全部</view>
    <view class="tab {{filterType==='ended'?'tab-on':''}}" data-type="ended" bindtap="onTabTap">已结束</view>
  </view>

  <view class="search">
    <input class="search-input"
      placeholder="搜索课程名称"
      placeholder-class="search-ph"
      value="{{searchText}}"
      bindinput="onSearchInput" />
    <view class="search-clear" wx:if="{{searchText}}" bindtap="onClearSearch">清空</view>
  </view>

  <view class="top-hint">提示：下拉页面可刷新课表；已加入的课程会显示进度</view>
</view>

<!-- 错误提示 -->
<view class="error" wx:if="{{errorText}}">
  <text class="error-text">{{errorText}}</text>
  <button class="error-btn" catchtap="onRetry">重试</button>
</view>

<!-- 加载态 -->
<view class="loading" wx:if="{{loading}}">
  <view class="skeleton"></view>
  <view class="skeleton"></view>
  <view class="skeleton"></view>
</view>

<!-- 空态 -->
<view class="empty" wx:if="{{!loading && !errorText && courseGroups.length===0}}">
  <view class="empty-title">暂无可展示课程</view>
  <view class="empty-sub">可切换筛选或清空搜索后再试</view>
</view>

<!-- 分组列表 -->
<view wx:for="{{courseGroups}}" wx:key="dateKey" class="group">
  <view class="group-hd">
    <view class="group-date">{{item.dateLabel}}</view>
    <view class="group-count">{{item.items.length}} 场</view>
  </view>

  <view wx:for="{{item.items}}" wx:key="id" class="card" data-id="{{item.id}}" bindtap="onCourseTap">
    <view class="card-top">
      <!-- [P3-PROGRESSUI-20251215] 左侧 tags：类型 + 进度 -->
      <view class="tags">
        <view class="pill {{item.pillClass}}">{{item.typeLabel}}</view>
        <view class="pill pill-progress {{item.progressPillClass}}" wx:if="{{item.progressText}}">
          {{item.progressText}}
        </view>
      </view>

      <view class="status {{item.statusClass}}">{{item.statusText}}</view>
    </view>

    <view class="card-title">{{item.title}}</view>

    <view class="card-meta">
      <text class="meta-time">{{item.timeText}}</text>
      <text class="meta-dot">·</text>
      <text class="meta-price">{{item.priceText}}</text>
    </view>

    <view class="card-desc" wx:if="{{item.desc}}">
      {{item.desc}}
    </view>

    <view class="card-actions">
      <button class="btn ghost" data-id="{{item.id}}" catchtap="onCourseTap">查看详情</button>

      <!-- 线下：预约来访 -->
      <button class="btn primary"
        wx:if="{{item.typeKey==='SALON'}}"
        data-id="{{item.id}}"
        catchtap="onSalonBooking">预约来访</button>

      <!-- [P3-PROGRESSUI-20251215] 已加入：查看进度 -->
      <button class="btn primary"
        wx:elif="{{item.joined}}"
        data-id="{{item.id}}"
        catchtap="onGoProgress">查看进度</button>
    </view>
  </view>
</view>

<view class="footer-gap"></view>
</view>
